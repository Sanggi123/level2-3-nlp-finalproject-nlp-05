<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./static/css/style.css">
    <title>오늘의 시</title>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        #firstPage {
            display: block;
        }

        #secondPage {
            display: none; 
        }

        #thirdPage {
            display: none;
        }

    </style>
</head>
<body class="bg-gray-100">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
    $(window).load(function () {
        $('body').sakura();
    });
    </script>

    <div class="flex justify-center items-center min-h-screen">
        <div class="container mx-auto p-4 max-w-2xl">
            <!-- #1 감정 선택 페이지 -->
            <div id="firstPage" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">오늘의 기분은?</h1>
                <p class="text-gray-700 mb-4">오늘 하루 어떠셨나요? 오늘의 감정을 선택해 보세요!</p>
                <form id="emotionOptions">
                    <div class="mb-4">
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio" name="emotion" value="행복하다">
                            <span class="ml-2">행복하다</span>
                        </label>
                        <label class="inline-flex items-center ml-6">
                            <input type="radio" class="form-radio" name="emotion" value="슬프다">
                            <span class="ml-2">슬프다</span>
                        </label>
                        <label class="inline-flex items-center ml-6">
                            <input type="radio" class="form-radio" name="emotion" value="화나다">
                            <span class="ml-2">화나다</span>
                        </label>
                        <label class="inline-flex items-center ml-6">
                            <input type="radio" class="form-radio" name="emotion" value="지루하다">
                            <span class="ml-2">지루하다</span>
                        </label>
                        <label class="inline-flex items-center ml-6">
                            <input type="radio" class="form-radio" name="emotion" value="놀라다">
                            <span class="ml-2">놀라다</span>
                        </label>
                    </div>
                    <button id="submitButton" type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="submitEmotion()">선택완료</button>
                </form>
            </div>

            <!-- #2 구절 선택 페이지 -->
            <div id="secondPage" class="hidden bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">마음에 드는 구절은?</h1>
                <p class="text-gray-700 mb-4">마음에 드는 문장을 선택하면 해당 구절로 시를 생성해 드려요!</p>
                <div class="mb-4">
                    <div class="flex items-center mb-2">
                        <input id="line1" type="radio" name="line" value="line1" class="form-radio mr-2">
                        <label for="line1" class="text-gray-700">line</label>
                    </div>
                    <div class="flex items-center mb-2">
                        <input id="line2" type="radio" name="line" value="line2" class="form-radio mr-2">
                        <label for="line2" class="text-gray-700">line</label>
                    </div>
                    <div class="flex items-center mb-2">
                        <input id="line3" type="radio" name="line" value="line3" class="form-radio mr-2">
                        <label for="line3" class="text-gray-700">line</label>
                    </div>
                </div> 
                <div class="flex justify-between">
                    <button id="reButton" type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition duration-300" onclick="submitEmotion()">다시 생성</button>
                    <div>
                        <button id="submitButton" type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition duration-300 mr-2" onclick="submitLine()">선택완료</button>
                        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition duration-300" onclick="back()">뒤로가기</button>
                    </div>
                </div>
            </div>

            <!-- #3 시 생성 페이지 -->
            <div id="thirdPage" class="hidden bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h1 class="block text-gray-700 text-xl font-bold mb-2">당신의 오늘과 어울리는 시</h1>
                <div class="flex mb-4">
                    <div class="w-1/2 mr-2">
                        <img src="https://via.placeholder.com/150" alt="이미지" class="rounded">
                    </div>
                    <div class="w-1/2 ml-2">
                        <pre id=poemContent class="text-gray-700">생성된 시</pre>
                    </div>
                </div>
                <div class="flex justify-center gap-4 mb-4">
                    <button id="saveButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        이미지와 시 저장
                    </button>
                    <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded" onclick="home()">
                        메인으로 돌아가기
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        function submitEmotion() {
            var emotion = $('input[name="emotion"]:checked').val(); // 선택된 라디오 버튼 값 가져오기
            if(emotion) { // 선택된 감정이 있을 경우
                generateLine(emotion); // generateLine 함수 호출
            } else {
                // 감정이 선택되지 않았을 경우의 처리, 예: 알림 표시
                alert("감정을 선택해주세요.");
            }
        }
        function generateLine(emotion) {
            $.ajax({
                    type: "POST",
                    url: "/api/line",
                    contentType: "application/json", // 요청의 Content-Type을 application/json으로 명시
                    data: JSON.stringify({ 'emotion': emotion }), // 객체를 JSON 문자열로 변환
                    success: function (response) {
                        lines = response.lines
                        showLine(lines)
                    }
                    })
        }
        function showLine(lines) {
            // firstPage를 숨깁니다.
            document.getElementById('firstPage').style.display = 'none';
            document.getElementById('secondPage').style.display = 'block';

            for (let i = 0; i < lines.length; i++) {
                document.getElementById(`line${i+1}`).value = lines[i];
                document.querySelector(`label[for=line${i+1}]`).textContent = lines[i];
            }
            $('input[name="line"]').prop('checked', false);
        }
        function submitLine() {
            var line = $('input[name="line"]:checked').val(); // 선택된 라디오 버튼 값 가져오기
            if(line) { // 선택된 구절이 있을 경우
                generatePoem(line); // generatePoem 함수 호출
            } else {
                // 구절이 선택되지 않았을 경우의 처리
                alert("구절을 선택해주세요.");
            }
        }
        function generatePoem(line) {
            $.ajax({
                    type: "POST",
                    url: "/api/poem",
                    contentType: "application/json", // 요청의 Content-Type을 application/json으로 명시
                    data: JSON.stringify({ 'line': line }), // 객체를 JSON 문자열로 변환
                    success: function (response) {
                        poem = response.poem
                        showPoem(poem)
                    }
                    })
        }
        function showPoem(poem) {
            document.getElementById('secondPage').style.display = 'none';
            document.getElementById('thirdPage').style.display = 'block';
            
            var poemContentElement = document.getElementById('poemContent');
            poemContentElement.textContent = poem;
        }
        function back() {
            document.getElementById('firstPage').style.display = 'block';
            document.getElementById('secondPage').style.display = 'none';
            $('input[name="emotion"]').prop('checked', false);
            $('input[name="line"]').prop('checked', false);
        }
        function home() {
            document.getElementById('firstPage').style.display = 'block';
            document.getElementById('secondPage').style.display = 'none';
            document.getElementById('thirdPage').style.display = 'none';
            $('input[name="emotion"]').prop('checked', false);
            $('input[name="line"]').prop('checked', false);
        }
    </script>
    <script src="./static/js/jquery_sakura.js"></script>
</body>
</html>